class l{observer=null;elements=new Set;observedParents=new Set;eagerTimeoutId=null;options;constructor(t={}){this.options={threshold:.1,rootMargin:"1000px",enableEagerLoading:!0,eagerDelay:150,batchSize:10,batchDelay:150,...t},!(typeof window>"u"||!("IntersectionObserver"in window))&&(this.observer=new IntersectionObserver(e=>{e.forEach(s=>{s.isIntersecting&&(s.target.hasAttribute("data-lazy-parent")?s.target.querySelectorAll("[data-lazy-child]").forEach(r=>{this.loadElement(r),this.elements.delete(r)}):(this.loadElement(s.target),this.elements.delete(s.target)),this.observer?.unobserve(s.target))})},{threshold:this.options.threshold,rootMargin:this.options.rootMargin}),this.options.enableEagerLoading&&this.setupEagerLoading())}shouldLoadElement(t){const e=t.getAttribute("data-lazy-when-query");return e?window.matchMedia(e).matches:!0}loadElement(t){if(this.shouldLoadElement(t)&&t.tagName==="VIDEO"){const e=t,s=e.getAttribute("data-src");s&&s!==e.src&&(e.src=s),e.querySelectorAll("source[data-src]").forEach(r=>{const a=r,n=a.getAttribute("data-src");n&&n!==a.src&&(a.src=n)}),e.load()}}setupEagerLoading(){const t=()=>{this.eagerTimeoutId=window.setTimeout(()=>{this.loadElementsInBatches()},this.options.eagerDelay)};document.readyState==="complete"?t():window.addEventListener("load",t,{once:!0})}loadElementsInBatches(){const t=Array.from(this.elements);let e=0;const s=()=>{t.slice(e,e+this.options.batchSize).forEach(r=>{if(this.elements.has(r))if(r.hasAttribute("data-lazy-child")){this.loadElement(r),this.elements.delete(r);const a=r.closest("[data-lazy-parent]");a&&!Array.from(this.elements).some(h=>h.hasAttribute("data-lazy-child")&&h.closest("[data-lazy-parent]")===a)&&this.observedParents.has(a)&&(this.observer?.unobserve(a),this.observedParents.delete(a))}else this.loadElement(r),this.elements.delete(r),this.observer&&this.observer.unobserve(r)}),e+=this.options.batchSize,e<t.length&&setTimeout(s,this.options.batchDelay)};t.length>0&&s()}observe(t){if(this.observer){if(t.hasAttribute("data-lazy-child")){const e=t.closest("[data-lazy-parent]");if(e){this.elements.add(t),this.observedParents.has(e)||(this.observer.observe(e),this.observedParents.add(e));return}}this.elements.add(t),this.observer.observe(t)}}unobserve(t){if(this.observer){if(t.hasAttribute("data-lazy-child")){const e=t.closest("[data-lazy-parent]");if(e){this.elements.delete(t),!Array.from(this.elements).some(i=>i.hasAttribute("data-lazy-child")&&i.closest("[data-lazy-parent]")===e)&&this.observedParents.has(e)&&(this.observer.unobserve(e),this.observedParents.delete(e));return}}this.observer.unobserve(t),this.elements.delete(t)}}disconnect(){this.observer&&(this.observer.disconnect(),this.elements.clear(),this.observedParents.clear(),this.eagerTimeoutId&&(clearTimeout(this.eagerTimeoutId),this.eagerTimeoutId=null))}findElementsToObserve(){document.querySelectorAll("[data-lazy-load]").forEach(e=>{this.observe(e)})}}let o=null;function c(d){return o||(o=new l(d),o.findElementsToObserve()),o}function u(){return o}export{u as g,c as i};
