import{E as V}from"./embla-carousel.esm.CMPFBS9o.js";import{s as z}from"./mute-group-store.CcuHwQRu.js";import{g as M}from"./lazy-load.WOLRxIkv.js";function H(S,r){let a=null;return function(...i){const m=()=>{a=null,S(...i)};a&&clearTimeout(a),a=setTimeout(m,r)}}const P={loop:!0,align:"center",skipSnaps:!1,dragFree:!1,containScroll:"trimSnaps",startIndex:0,duration:20,inViewThreshold:.7},W=document.querySelectorAll("[data-carousel-viewport]");W.forEach(S=>{const r=S,h=r.closest(".video-carousel-section")?.getAttribute("data-mute-group"),i=r.querySelector("[data-carousel-container]"),m=document.querySelector("[data-carousel-prev]"),w=document.querySelector("[data-carousel-next]"),d=i.querySelectorAll("[data-carousel-item]");function u(){h&&z(h,!1)}if(!i||d.length===0)return;const x=()=>{i.querySelectorAll("[data-clone='true']").forEach(v=>v.remove());const e=r.offsetWidth,n=d[0].offsetWidth,l=Math.ceil(e/n)+4;if(d.length>=l)return;const b=Math.ceil(l/d.length);for(let v=1;v<b;v++)d.forEach((A,c)=>{const g=A.cloneNode(!0);g.setAttribute("data-clone","true"),g.setAttribute("data-original-index",String(c)),g.querySelectorAll("video").forEach(O=>{O.setAttribute("data-lazy-load","true")}),i.appendChild(g)});M()?.findElementsToObserve()};x();const o=V(r,P);let E=!1;const y=H(()=>{x(),o.reInit()},300);window.addEventListener("resize",y);const p=()=>{const e=o.selectedScrollSnap(),t=i.querySelectorAll("[data-carousel-item]"),n=t[e];if(!n)return;const s=parseInt(n.getAttribute("data-original-index")||n.getAttribute("data-index")||"-1");t.forEach((l,b)=>{const A=parseInt(l.getAttribute("data-original-index")||l.getAttribute("data-index")||"-1")===s;l.setAttribute("data-active",String(A));const c=l.querySelector("video");c&&(b===e&&E?c.play().catch(()=>{}):(c.pause(),c.currentTime=0))})},q=()=>{o.scrollPrev(),u()},k=()=>{o.scrollNext(),u()};o.on("init",p),o.on("select",p),m&&m.addEventListener("click",q),w&&w.addEventListener("click",k);const T=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;const t=r.getBoundingClientRect();t.top<window.innerHeight&&t.bottom>0&&(e.key==="ArrowLeft"?(e.preventDefault(),o.scrollPrev(),u()):e.key==="ArrowRight"&&(e.preventDefault(),o.scrollNext(),u()))};document.addEventListener("keydown",T);const N=()=>{i.querySelectorAll("[data-carousel-item]").forEach((t,n)=>{t.addEventListener("click",()=>{o.scrollTo(n),u()})})},f=new Map,C=()=>{f.forEach((t,n)=>{n.removeEventListener("video-ended-custom",t)}),f.clear();const e=t=>{const n=t.detail.target;if(n){const s=n.closest("[data-carousel-item]");s&&s.getAttribute("data-active")==="true"&&o.scrollNext()}};document.addEventListener("video-ended-custom",e),f.set(document,e)},I=new IntersectionObserver(e=>{e.forEach(t=>{t.isIntersecting?(E=!0,p()):(E=!1,i.querySelectorAll("video").forEach(s=>{s.pause()}))})},{threshold:.5});I.observe(r);const L=()=>{p(),C(),N()};o.on("init",L),o.on("reInit",L),window.addEventListener("beforeunload",()=>{window.removeEventListener("resize",y),I.disconnect(),f.forEach((e,t)=>{t.removeEventListener("ended",e)}),f.clear()})});
